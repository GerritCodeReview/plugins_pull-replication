{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "bbe77317_03fd47ab",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 9,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2022-12-29T12:08:15Z",
      "side": 1,
      "message": "actually it does two request, first is `/info/refs?service\u003dgit-upload-pack` which is the negotiation phase and second is POST one where data are transferred",
      "range": {
        "startLine": 9,
        "startChar": 89,
        "endLine": 9,
        "endChar": 125
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d941c1eb_78886825",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 9,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2022-12-29T12:08:15Z",
      "side": 1,
      "message": "\"from other Gerrit instances\" other primary instances are fetching data as well",
      "range": {
        "startLine": 9,
        "startChar": 363,
        "endLine": 9,
        "endChar": 370
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "466d854f_15ebc1ce",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 9,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2022-12-29T13:04:47Z",
      "side": 1,
      "message": "I did not know it but i appreciate it. Let  me know if you want me to update the comment.",
      "parentUuid": "bbe77317_03fd47ab",
      "range": {
        "startLine": 9,
        "startChar": 89,
        "endLine": 9,
        "endChar": 125
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a3c704c8_8b34c8de",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 9,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2022-12-29T13:04:47Z",
      "side": 1,
      "message": "good one.",
      "parentUuid": "d941c1eb_78886825",
      "range": {
        "startLine": 9,
        "startChar": 363,
        "endLine": 9,
        "endChar": 370
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "63e60cd0_979b0612",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 9,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-12-29T13:37:58Z",
      "side": 1,
      "message": "Also can you wrap the message?",
      "parentUuid": "466d854f_15ebc1ce",
      "range": {
        "startLine": 9,
        "startChar": 89,
        "endLine": 9,
        "endChar": 125
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1e392579_6931045d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 11,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2022-12-29T12:08:15Z",
      "side": 1,
      "message": "same as above",
      "range": {
        "startLine": 11,
        "startChar": 158,
        "endLine": 11,
        "endChar": 165
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ac2a00ad_4d034226",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 11,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2022-12-29T13:04:47Z",
      "side": 1,
      "message": "good one",
      "parentUuid": "1e392579_6931045d",
      "range": {
        "startLine": 11,
        "startChar": 158,
        "endLine": 11,
        "endChar": 165
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1b7e2a17_f680afd1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2022-12-29T09:55:00Z",
      "side": 1,
      "message": "Luca, I addressed the comment",
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1fe3c340_3744c94d",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/BearerAuthenticationFilter.java",
        "patchSetId": 9
      },
      "lineNbr": 88,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2022-12-29T12:08:15Z",
      "side": 1,
      "message": "I\u0027m not sure if that is enough. What will happen if I have url without `/a/` so I want to do the anonymous clone but I have basic authentication header? Then code will try to check bearerToken and it will not match so anonymous clone will be blocked with `HttpServletResponse.SC_UNAUTHORIZED`",
      "range": {
        "startLine": 88,
        "startChar": 11,
        "endLine": 88,
        "endChar": 90
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "494fad05_f1863921",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/BearerAuthenticationFilter.java",
        "patchSetId": 9
      },
      "lineNbr": 88,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2022-12-29T13:04:47Z",
      "side": 1,
      "message": "Are not they mutual exclusive? or you are anonymous or you are not. If there is an anonymous clone with basic authentication, IMO there is a bug in the client.\n\nwdyt?",
      "parentUuid": "1fe3c340_3744c94d",
      "range": {
        "startLine": 88,
        "startChar": 11,
        "endLine": 88,
        "endChar": 90
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a3f6bc34_7731d3e0",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/BearerAuthenticationFilter.java",
        "patchSetId": 9
      },
      "lineNbr": 88,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2022-12-29T13:12:54Z",
      "side": 1,
      "message": "we should preserve the current behaviour. Check what is going to happen if you make a clone with anonymous url but with basic authentication header(you can put some invalid credentials) if clone pass we have to have the same functionality here",
      "parentUuid": "494fad05_f1863921",
      "range": {
        "startLine": 88,
        "startChar": 11,
        "endLine": 88,
        "endChar": 90
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a3fabb62_091061ec",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/BearerAuthenticationFilter.java",
        "patchSetId": 9
      },
      "lineNbr": 88,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2022-12-29T13:37:58Z",
      "side": 1,
      "message": "Well, if the client has the bearer token, we *must* check for it. It is pretty much like having the `/a/` and we provide the wrong credentials: Gerrit will fail if the credentials are incorrect.\n\nThe same apply here: the client *sends* the Bearer token and then *expects* to be authenticated. If the credentials do not match, we should fail, regardless of what the resource is.",
      "parentUuid": "a3f6bc34_7731d3e0",
      "range": {
        "startLine": 88,
        "startChar": 11,
        "endLine": 88,
        "endChar": 90
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d60b3b2b_099f8519",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/BearerAuthenticationFilter.java",
        "patchSetId": 9
      },
      "lineNbr": 88,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2022-12-29T13:41:36Z",
      "side": 1,
      "message": "Exactly, but what if we have `Authorization` header but it\u0027s not bearer token?",
      "parentUuid": "a3fabb62_091061ec",
      "range": {
        "startLine": 88,
        "startChar": 11,
        "endLine": 88,
        "endChar": 90
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7c052758_94b8f291",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/BearerAuthenticationFilter.java",
        "patchSetId": 9
      },
      "lineNbr": 88,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2022-12-29T13:51:11Z",
      "side": 1,
      "message": "The way that i see this is:\n1 if the url has `/a` then `Authentication header` (Basic authentication) is expected\n2  if the url has NO `/a` then can be one of these:\n    2.1 `Authentication header` (Bearer token)\n    2.2 No `Authentication header` \u003d\u003e anonymous\n    \nThe case that you mean is 2.1\n\nTo you example I would expect `SC_UNAUTHORIZED`\n\nIt seems that we have different opinions.",
      "parentUuid": "a3f6bc34_7731d3e0",
      "range": {
        "startLine": 88,
        "startChar": 11,
        "endLine": 88,
        "endChar": 90
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "532aba5f_ff6fe1a4",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/BearerAuthenticationFilter.java",
        "patchSetId": 9
      },
      "lineNbr": 88,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2022-12-29T14:00:45Z",
      "side": 1,
      "message": "\u003e Exactly, but what if we have Authorization header but it\u0027s not bearer token?\n\nif you have an authorization header and is not bearer token it should be basic authentication and it should have `/a` in the url.",
      "parentUuid": "7c052758_94b8f291",
      "range": {
        "startLine": 88,
        "startChar": 11,
        "endLine": 88,
        "endChar": 90
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6e9d0636_4584438c",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/BearerAuthenticationFilter.java",
        "patchSetId": 9
      },
      "lineNbr": 88,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2022-12-29T14:00:47Z",
      "side": 1,
      "message": "It\u0027s not about opinion but about how Gerrit works without pull-replication.\nTry:\n1. git clone \"https://maczech:fake_password@review.gerrithub.io/GerritForge/aws-gerrit\" \u003c- this will work\n2. git clone \"https://maczech:fake_password@review.gerrithub.io/a/GerritForge/aws-gerrit\" \u003c- this will fail\n3. git clone \"https://maczech:real_password@review.gerrithub.io/a/GerritForge/aws-gerrit\" \u003c- this will work\n\nWith pull-replication and bearerToken point number one will fail",
      "parentUuid": "7c052758_94b8f291",
      "range": {
        "startLine": 88,
        "startChar": 11,
        "endLine": 88,
        "endChar": 90
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9d925280_6add0472",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/BearerAuthenticationFilter.java",
        "patchSetId": 9
      },
      "lineNbr": 88,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2022-12-29T14:05:07Z",
      "side": 1,
      "message": "I think 1 should fail.",
      "parentUuid": "6e9d0636_4584438c",
      "range": {
        "startLine": 88,
        "startChar": 11,
        "endLine": 88,
        "endChar": 90
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d4e58d85_835063ee",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/BearerAuthenticationFilter.java",
        "patchSetId": 9
      },
      "lineNbr": 103,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2022-12-29T12:08:15Z",
      "side": 1,
      "message": "maybe isGitUploadPackRequestWithAuthorization because I can pass bearer token from git client as well",
      "range": {
        "startLine": 103,
        "startChar": 18,
        "endLine": 103,
        "endChar": 50
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f0abb38b_753fa250",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/BearerAuthenticationFilter.java",
        "patchSetId": 9
      },
      "lineNbr": 103,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2022-12-29T13:04:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d4e58d85_835063ee",
      "range": {
        "startLine": 103,
        "startChar": 18,
        "endLine": 103,
        "endChar": 50
      },
      "revId": "a7c19fa45583c33212b35bf94bbcc1e882854c53",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}