{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ab4c0ef4_55b68d9a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-05-03T10:48:11Z",
      "side": 1,
      "message": "I would expect also the documentation to be changed: this change would require to have the delete-project.jar put into $GERRIT_SITE/lib.\n\nP.S. Shall we target master? This is a breaking change.",
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f877e443_77d78e2c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-05-03T12:00:13Z",
      "side": 1,
      "message": "Thanks for highlighting, I will see if i can figure out how/where to do that",
      "parentUuid": "ab4c0ef4_55b68d9a",
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fd1b698c_1a4b4a43",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-05-08T12:03:14Z",
      "side": 1,
      "message": "Reopening as I mistakenly resolved it without being done.",
      "parentUuid": "f877e443_77d78e2c",
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f21932f4_e6f6595f",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 20,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2023-05-03T09:46:51Z",
      "side": 1,
      "message": "I think this should be a `:neverlink`. @david.ostrovsky@gmail.com what do you think?",
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "13e53a23_198a9f43",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 20,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-05-03T10:48:11Z",
      "side": 1,
      "message": "+1",
      "parentUuid": "f21932f4_e6f6595f",
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2ae14dae_17ec0c1b",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 20,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-05-03T12:00:13Z",
      "side": 1,
      "message": "I will need some help to understand how to do this, and also I have to ask - if it needs a `neverlink`, shouldn\u0027t this be the same for the `replication` plugin?",
      "parentUuid": "13e53a23_198a9f43",
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2ced3674_9cf42753",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 20,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-05-03T12:39:38Z",
      "side": 1,
      "message": "Yes, exactly. We have the same issue there, possibly with a separate change.",
      "parentUuid": "2ae14dae_17ec0c1b",
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "af8d25d5_9be4c0d7",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 20,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2023-05-04T05:28:44Z",
      "side": 1,
      "message": "Neverlink vs. shaded jar: We don\u0027t have dynamic inter-plugin dependencies. That\u0027s why we have to options: shade the dependent code in plugin artifact, or don\u0027t shade them but link the dependent plugin in `\u003cgerrit_site\u003e/lib` directory and thus hoist them in `gerrit`\u0027s core classloader.\n\nGiven, that we already re-use `replication`-plugin code in `multi-site` plugin without shading it in `multi-site.jar` artifact and use `:replication-neverlink`, I would also tend to keep that behavior here as well.\n\n\u003e Yes, exactly. We have the same issue there, possibly with a separate change.\n\n+1.",
      "parentUuid": "2ced3674_9cf42753",
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e4e85a4a_0f928e75",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 20,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-05-08T12:01:27Z",
      "side": 1,
      "message": "So i guess we will leave it as is - for consistency - and we just need to document the change in behaviour, ie we need to drop the delete-project.jar in the lib directory? Is this the consensus we\u0027ve reached?",
      "parentUuid": "af8d25d5_9be4c0d7",
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cd7042f5_a1e945df",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 20,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-05-09T08:37:50Z",
      "side": 1,
      "message": "Ok so re-reading David\u0027s reply, and having spent a bit more time to understand it, here\u0027s a summary of my understanding:\n\n- Current version of my code shades the dependent code in the plugin artifact, essentially creating a fat jar which also contains the `delete-project` plugin code. This means that dropping the `pull-replication` jar in the plugins dir should be sufficient, ie we don\u0027t need to drop the delete-project.jar in the `/lib` directory.\n- If we were to keep this approach, we don\u0027t need to document anything as the `pull-replication` plugin does not need any extra configuration.\n- This behaviour is also what we currently do for the dependencies on the `replication` plugin. \n- Apparently this behaviour was also applied for the `multi-site` plugin, but David fixed it https://gerrit-review.googlesource.com/c/plugins/multi-site/+/245692\n- The alternative to shading is to use `neverlink` which means the dependency is provided. This also requires the dependent jar to be present in the `/lib` directory.\n- We want to change the code in this CR to use `neverlink`, basically re-using the same approach as David did for `multi-site`. This means we will need to also update the documentation, to explain the additional step required to configure the plugin (ie the `delete-project.jar` should be dropped in the `/lib` dir).\n- Going forward, in `pull-replication` we want to stop shading the `replication` jar, but this will be done as a separate change.\n\n@davido @luca can you please confirm if the above is accurate, and whether I should follow the same approach as we did with `multi-site`?",
      "parentUuid": "e4e85a4a_0f928e75",
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8b12aad5_93380237",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 54,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2023-05-04T05:28:44Z",
      "side": 1,
      "message": "This wasn\u0027t changed in this commit: This rule name is not needed, as this is default: Bazel rule name is the same as Bazel package name. Also note, if you run `buildifier` utility: [1] on this file (that some CI-jobs are doing) that suffix will be removed.\n\n[1]: https://github.com/bazelbuild/buildtools/tree/master/buildifier",
      "range": {
        "startLine": 54,
        "startChar": 30,
        "endLine": 54,
        "endChar": 42
      },
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e2042f45_c727ccf0",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 54,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-05-08T12:01:27Z",
      "side": 1,
      "message": "Ah cool, thanks for the info and for the link!\nI will run the tool and commit its output",
      "parentUuid": "8b12aad5_93380237",
      "range": {
        "startLine": 54,
        "startChar": 30,
        "endLine": 54,
        "endChar": 42
      },
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d112ea84_cec10b49",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 55,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2023-05-04T05:28:44Z",
      "side": 1,
      "message": "Same here.",
      "range": {
        "startLine": 55,
        "startChar": 33,
        "endLine": 55,
        "endChar": 48
      },
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e366d4d4_fc69eb92",
        "filename": "BUILD",
        "patchSetId": 5
      },
      "lineNbr": 55,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-05-08T12:01:27Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "d112ea84_cec10b49",
      "range": {
        "startLine": 55,
        "startChar": 33,
        "endLine": 55,
        "endChar": 48
      },
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c5b30a4b_8648bc4b",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectDeletionAction.java",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2023-05-03T09:46:51Z",
      "side": 1,
      "message": "Are the tests for this class still passing?",
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ed1f38b8_ed7e189f",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectDeletionAction.java",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-05-08T12:01:27Z",
      "side": 1,
      "message": "yes, they are both locally and on the CI server",
      "parentUuid": "c5b30a4b_8648bc4b",
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "611938a8_879eba01",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectDeletionAction.java",
        "patchSetId": 5
      },
      "lineNbr": 21,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-05-03T10:48:11Z",
      "side": 1,
      "message": "We don\u0027t use `*` imports in Gerrit.",
      "range": {
        "startLine": 21,
        "startChar": 43,
        "endLine": 21,
        "endChar": 45
      },
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c69e653f_04b76445",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectDeletionAction.java",
        "patchSetId": 5
      },
      "lineNbr": 21,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-05-08T12:01:27Z",
      "side": 1,
      "message": "Ok - thanks for letting me know",
      "parentUuid": "611938a8_879eba01",
      "range": {
        "startLine": 21,
        "startChar": 43,
        "endLine": 21,
        "endChar": 45
      },
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ef4077ce_9141d0ff",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectDeletionAction.java",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2023-05-03T09:46:51Z",
      "side": 1,
      "message": "Why not call them `PRESERVE_GIT_REPO` and `ARCHIVE_DELETED_REPO` as in the `delete` interface:\n\n```\n   * @param preserveGitRepository - if true, just remove the repo from the git cache, but keep the\n   *     repo on disk.\n   * @param archiveDeletedRepos - if true, copy the repo to an archived path, and delete the\n   *     original directory.\n```",
      "range": {
        "startLine": 37,
        "startChar": 31,
        "endLine": 37,
        "endChar": 51
      },
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9fb7acd8_4b2a9605",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectDeletionAction.java",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-05-08T12:01:27Z",
      "side": 1,
      "message": "Good point, done üëç",
      "parentUuid": "ef4077ce_9141d0ff",
      "range": {
        "startLine": 37,
        "startChar": 31,
        "endLine": 37,
        "endChar": 51
      },
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5d867e03_d29c2921",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectDeletionAction.java",
        "patchSetId": 5
      },
      "lineNbr": 84,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2023-05-03T09:46:51Z",
      "side": 1,
      "message": "We are not catching the `RepositoryNotFoundException` exception here.\n\n* Will Gerrit return a 404 if we let it propagate?\n* Are we handling correctly client side the case where `RepositoryNotFoundException` is thrown?",
      "range": {
        "startLine": 84,
        "startChar": 8,
        "endLine": 84,
        "endChar": 30
      },
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "af49fc6d_efcfa58a",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectDeletionAction.java",
        "patchSetId": 5
      },
      "lineNbr": 84,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-05-08T12:01:27Z",
      "side": 1,
      "message": "Well, we are catching it because its a subclass of `IOException`, however we will end up returning `UnprocessableEntityException` which the `PullReplicationFilter` treats as a 422 http code. Worth highlighting this is existing behaviour, but perhaps we should catch the `RepositoryNotFoundException` and rethrow it as a ResourceNotFoundException? WDYT?",
      "parentUuid": "5d867e03_d29c2921",
      "range": {
        "startLine": 84,
        "startChar": 8,
        "endLine": 84,
        "endChar": 30
      },
      "revId": "810f9dfdd36408152baed6f308c097daa0519897",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}