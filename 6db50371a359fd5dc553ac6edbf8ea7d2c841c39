{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "52aea102_65709921",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 7,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-11-02T18:59:07Z",
      "side": 1,
      "message": "Wouldn\u0027t this give a false perception that replication works fine? \n\nUsers do use the sync replication for a reason. Secretly switching to async replication doesn\u0027t feel good.\n\nWhat will happen when the sync replication is constantly failing? Will we build up a backlog of async replications in the background?\n\nIMO we should at least log a warning and possibly have a configuration option to enable fallback to async replication.",
      "revId": "6db50371a359fd5dc553ac6edbf8ea7d2c841c39",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2adfebb3_655817f4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 4
      },
      "lineNbr": 7,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-11-09T12:31:07Z",
      "side": 1,
      "message": "\u003e Wouldn\u0027t this give a false perception that replication works fine? \n\nIt actually works fine: sync replication is a \"wish\" rather than a \"requirement\"\n\n\u003e Users do use the sync replication for a reason. Secretly switching to async replication doesn\u0027t feel good.\n\nWell, replication is an _eventually consistent_ strategy to align different sites. Synchronous replication is for minimising the split-brain alerts and lock errors, but it may fail.\n\nYou should never assume that all sites are always up-to-date and always responding quicklu.\n\n\u003e What will happen when the sync replication is constantly failing? Will we build up a backlog of async replications in the background?\n\nThat\u0027s not different on what happens when a site is down: the replication events will be queued and eventually executed.\n\n\u003e IMO we should at least log a warning and possibly have a configuration option to enable fallback to async replication.\n\nYou should never ever disable the fallback, so a config option would be a mistake IMHO. A warning isn\u0027t needed because the failure of the apply object is already flagged in the logs.",
      "parentUuid": "52aea102_65709921",
      "revId": "6db50371a359fd5dc553ac6edbf8ea7d2c841c39",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "db60a8bf_784c0e24",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-11-09T12:31:07Z",
      "side": 1,
      "message": "Adding @matthias.sohn@gmail.com who has just been hit by this issue on eclipse.gerrithub.io ðŸ˜ž",
      "revId": "6db50371a359fd5dc553ac6edbf8ea7d2c841c39",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "faa14cb0_e5921d90",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/client/FetchRestApiClient.java",
        "patchSetId": 4
      },
      "lineNbr": 119,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-11-09T15:37:16Z",
      "side": 1,
      "message": "nit: I don\u0027t like to pass `Optinal`s as arguments. Can we assume that the default replication type is async? Then we can pass `ReplicationType.ASYNC` instead of `Optional.empty()` and have something like:\n\n```java\nBoolean callAsync \u003d Optional.of(resplicationType)\n    .map(rto \u003d\u003e rto \u003d\u003d Replicationatype.ASYNC)\n    .orElseGet(() \u003d\u003e !syncRefsFilter.match(refName));\n```\n\nFor better readability, we can also define `DEFAULT_REPLICATION_TYPE \u003d ReplicationType.ASYNC` and use that constant instead of `Optional.empty()`.\n\nWDYT?",
      "revId": "6db50371a359fd5dc553ac6edbf8ea7d2c841c39",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5cff6d45_4b0cd1bc",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/client/FetchRestApiClient.java",
        "patchSetId": 4
      },
      "lineNbr": 119,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-11-20T11:17:16Z",
      "side": 1,
      "message": "\u003e nit: I don\u0027t like to pass `Optinal`s as arguments. \n\nIs this just a general preference or a guideline you saw somewhere?\nI personally prefer Optional\u003c\u003e rather than nulls.\n\n\u003eCan we assume that the default replication type is async?\n\nThe default is taken from the replication.config, so that\u0027s not an option.\n\n\u003e Then we can pass `ReplicationType.ASYNC` instead of `Optional.empty()` and have something like:\n\u003e \n\u003e ```java\n\u003e Boolean callAsync \u003d Optional.of(resplicationType)\n\u003e     .map(rto \u003d\u003e rto \u003d\u003d Replicationatype.ASYNC)\n\u003e     .orElseGet(() \u003d\u003e !syncRefsFilter.match(refName));\n\u003e ```\n\u003e \n\u003e For better readability, we can also define `DEFAULT_REPLICATION_TYPE \u003d ReplicationType.ASYNC` and use that constant instead of `Optional.empty()`.\n\nWe could instead define a `ReplicationType.AUTO` which means that is read from config, WDYT?",
      "parentUuid": "faa14cb0_e5921d90",
      "revId": "6db50371a359fd5dc553ac6edbf8ea7d2c841c39",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}