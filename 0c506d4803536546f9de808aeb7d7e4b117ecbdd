{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "e7412a62_0445b85e",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/DeleteApiCapability.java",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-12-07T15:43:11Z",
      "side": 1,
      "message": "2021",
      "range": {
        "startLine": 1,
        "startChar": 17,
        "endLine": 1,
        "endChar": 21
      },
      "revId": "0c506d4803536546f9de808aeb7d7e4b117ecbdd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c8ec4fa3_6ea76122",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/DeleteApiCapability.java",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2021-12-10T14:18:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e7412a62_0445b85e",
      "range": {
        "startLine": 1,
        "startChar": 17,
        "endLine": 1,
        "endChar": 21
      },
      "revId": "0c506d4803536546f9de808aeb7d7e4b117ecbdd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f7d86bbe_cec1c361",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectDeletionAction.java",
        "patchSetId": 2
      },
      "lineNbr": 46,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-12-07T15:43:11Z",
      "side": 1,
      "message": "I don\u0027t understand why we need to change this code.\n\nThe deletion mechanism implemented in the Action already removes the project without having to refactor it to use the DeleteProject plugin.\n\nIs this refactoring necessary or is it just an enhancement?\n\nIf that\u0027s the case, then I don\u0027t think it should be done as part of this change.",
      "range": {
        "startLine": 46,
        "startChar": 1,
        "endLine": 46,
        "endChar": 71
      },
      "revId": "0c506d4803536546f9de808aeb7d7e4b117ecbdd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7dceef04_d9909485",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectDeletionAction.java",
        "patchSetId": 2
      },
      "lineNbr": 46,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2021-12-09T09:55:02Z",
      "side": 1,
      "message": "I see tow things here:\n1. We have to duplicate the logic instead of just reuse it\n2. I thin just removing the repository from the local drive is not enough, if you look at https://gerrit.googlesource.com/plugins/delete-project/+/refs/heads/master/src/main/java/com/googlesource/gerrit/plugins/deleteproject/DeleteProject.java#81\n\nIf I understand it correctly it is removing changes related to this project:\nhttps://gerrit.googlesource.com/plugins/delete-project/+/refs/heads/master/src/main/java/com/googlesource/gerrit/plugins/deleteproject/database/DatabaseDeleteHandler.java#97\n\nupdating the index, removing from disk, updating cache and logging to audit log.",
      "parentUuid": "f7d86bbe_cec1c361",
      "range": {
        "startLine": 46,
        "startChar": 1,
        "endLine": 46,
        "endChar": 71
      },
      "revId": "0c506d4803536546f9de808aeb7d7e4b117ecbdd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "47e63282_0c49eef1",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectDeletionAction.java",
        "patchSetId": 2
      },
      "lineNbr": 46,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-12-09T10:28:33Z",
      "side": 1,
      "message": "\u003e I see tow things here:\n\u003e 1. We have to duplicate the logic instead of just reuse it\n\nDRY-ing this out would justify a refactoring, but it is not strictly related to using the pull-replication REST api endpoint.\n\n\u003e 2. I thin just removing the repository from the local drive is not enough, if you look at https://gerrit.googlesource.com/plugins/delete-project/+/refs/heads/master/src/main/java/com/googlesource/gerrit/plugins/deleteproject/DeleteProject.java#81\n\u003e \n\u003e If I understand it correctly it is removing changes related to this project:\n\u003e https://gerrit.googlesource.com/plugins/delete-project/+/refs/heads/master/src/main/java/com/googlesource/gerrit/plugins/deleteproject/database/DatabaseDeleteHandler.java#97\n\u003e \n\u003e updating the index, removing from disk, updating cache and logging to audit log.\n\nBut isn\u0027t this responsibility of multi-site / high-availability plugin?\n\nEven in the (push) replication implementation project deletion will not cause any reindexing unless the (gerrit+http protocol is used, which deprecated).\n\nIf pull-replication is replicating between primary and a replica, then there is no index to update: only the group index is available.\n\nIf pull-replication is installed between primary and primary, then you must have either multi-site / high-availability which will take care of this.\n\nI am not saying the refactoring is necessarily wrong (we might want to discuss about it), but I don\u0027t think it should be part of this change.\n\nWDYT?",
      "parentUuid": "7dceef04_d9909485",
      "range": {
        "startLine": 46,
        "startChar": 1,
        "endLine": 46,
        "endChar": 71
      },
      "revId": "0c506d4803536546f9de808aeb7d7e4b117ecbdd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "61d9528e_60b2464c",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectDeletionAction.java",
        "patchSetId": 2
      },
      "lineNbr": 46,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2021-12-10T09:38:49Z",
      "side": 1,
      "message": "In my opinion before this change logic was blur. For primary-primary we were using delete-project plugin logic but for primary-replica we had custom logic inside pull-replication plugin, it was hard to justify why we need two different approach to delete project. When I started this refactoring I had to decide which one to pick, in my opinion reusing delete-project plugin a is better approach because it give us guarantee that all necessary steps all executed(for example logging in audit log)",
      "parentUuid": "47e63282_0c49eef1",
      "range": {
        "startLine": 46,
        "startChar": 1,
        "endLine": 46,
        "endChar": 71
      },
      "revId": "0c506d4803536546f9de808aeb7d7e4b117ecbdd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "94c55b6a_721c4711",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectDeletionAction.java",
        "patchSetId": 2
      },
      "lineNbr": 46,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-12-10T09:53:51Z",
      "side": 1,
      "message": "This change now does two things:\n\n1 - Replace direct call to the delete-project plugin REST API endpoint with\nthe call to the pull-replication REST API (the commit message)\n\n2 - Rewriting the pull-replication REST API implementation by using the core one.\n\nI think step 2 is not necessarily wrong (as I said, we can discuss about it), but it not necessary to achieve what this issue is about.\n\nIf you feel strongly about this we could separate the refactoring into its own change and then base this one off it?",
      "parentUuid": "61d9528e_60b2464c",
      "range": {
        "startLine": 46,
        "startChar": 1,
        "endLine": 46,
        "endChar": 71
      },
      "revId": "0c506d4803536546f9de808aeb7d7e4b117ecbdd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "161b5211_f24545b5",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectDeletionAction.java",
        "patchSetId": 2
      },
      "lineNbr": 46,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2021-12-10T10:18:09Z",
      "side": 1,
      "message": "Ok I can split it into two changes it\u0027s not a problem",
      "parentUuid": "94c55b6a_721c4711",
      "range": {
        "startLine": 46,
        "startChar": 1,
        "endLine": 46,
        "endChar": 71
      },
      "revId": "0c506d4803536546f9de808aeb7d7e4b117ecbdd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "de3cd5e7_7463b580",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/pull/api/ActionITBase.java",
        "patchSetId": 2
      },
      "lineNbr": 69,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-12-07T15:43:11Z",
      "side": 1,
      "message": "Is this needed?",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 69,
        "endChar": 60
      },
      "revId": "0c506d4803536546f9de808aeb7d7e4b117ecbdd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "485c8cd5_3c84c71b",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/pull/api/ActionITBase.java",
        "patchSetId": 2
      },
      "lineNbr": 69,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2021-12-10T14:18:00Z",
      "side": 1,
      "message": "Good catch! This was just for debugging",
      "parentUuid": "de3cd5e7_7463b580",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 69,
        "endChar": 60
      },
      "revId": "0c506d4803536546f9de808aeb7d7e4b117ecbdd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}