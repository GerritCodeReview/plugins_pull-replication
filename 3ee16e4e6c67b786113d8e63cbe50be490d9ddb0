{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "1df1b399_5ad66624",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 22,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2023-12-27T18:12:46Z",
      "side": 1,
      "message": "I would leave the details of reproducing the bug in the issue tracker.\n\nMaybe you can mention that this can lead to issues when having a complex setup with HA + MS. I would focus the description on explaining we weren\u0027t sending events once the project was created.",
      "range": {
        "startLine": 9,
        "startChar": 1,
        "endLine": 22,
        "endChar": 0
      },
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c12bb50_41e76872",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 22,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-12-27T21:58:46Z",
      "side": 1,
      "message": "Agreed, we should focus on the rationale but not in _one specific test-case_ that this fix is addressing.\n\nWhat about saying that _\"All plugins that are reacting on the creation of a project were not able to detect the ones created via replication, with unpredictable consequences\"_",
      "parentUuid": "1df1b399_5ad66624",
      "range": {
        "startLine": 9,
        "startChar": 1,
        "endLine": 22,
        "endChar": 0
      },
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fdbc6b2b_9ddf1104",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 22,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-28T10:07:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3c12bb50_41e76872",
      "range": {
        "startLine": 9,
        "startChar": 1,
        "endLine": 22,
        "endChar": 0
      },
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3734f4ce_4c894c1b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 26,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-12-27T21:58:46Z",
      "side": 1,
      "message": "That is only *one special case* but you may have other listeners that would be interested to know that a project was created.",
      "range": {
        "startLine": 24,
        "startChar": 30,
        "endLine": 26,
        "endChar": 20
      },
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c45cd337_618a3cbd",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 26,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-28T10:07:23Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "3734f4ce_4c894c1b",
      "range": {
        "startLine": 24,
        "startChar": 30,
        "endLine": 26,
        "endChar": 20
      },
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d5b029a5_a0d351c6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-12-27T21:58:46Z",
      "side": 1,
      "message": "Do you foresee an easy way to test this?",
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "369499c7_0023dd4e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-28T10:07:23Z",
      "side": 1,
      "message": "I have manually tested it.",
      "parentUuid": "d5b029a5_a0d351c6",
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9ab7dfe7_d230abd7",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectInitializationAction.java",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2023-12-27T18:12:46Z",
      "side": 1,
      "message": "We have already some IT tests for the `ProjectInitializationAction`. Might be worth cover this case as well.",
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fa1119e8_f06c92ab",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectInitializationAction.java",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-28T10:07:23Z",
      "side": 1,
      "message": "Yes, I looked into those tests but they are quite geared towards the endpoint itself, not any side operations. I don\u0027t know how to check in the test that a listener was invoked, but if you are aware of any existing tests that do anything similar, feel free to let me know so I can take a look for inspiration.",
      "parentUuid": "9ab7dfe7_d230abd7",
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7e6a7019_0e1540ec",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectInitializationAction.java",
        "patchSetId": 3
      },
      "lineNbr": 164,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2023-12-27T18:12:46Z",
      "side": 1,
      "message": "If we bail out here we are not propagating any event, still the project might be created by the `initProject`.\n\nI think we should have it in the `initProject` as well.",
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "075a5c30_aeee8d31",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectInitializationAction.java",
        "patchSetId": 3
      },
      "lineNbr": 164,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-28T10:07:23Z",
      "side": 1,
      "message": "\u003e I think we should have it in the initProject as well.\n\nNo, it needs to be in one place only, why notify the listener multiple times of the same event? It then becomes noise. In addition, if `initProject` fails, most likely the project is not created. And actually, the \"proper\" place would be the `LocalFS.createProject`, if you want to send the event after the (even bare) repo is created.I think it makes sense to have it where it currently is, ie sent after a project is successfully created. IMO this also tells a more accurate tale to the listeners of the event.",
      "parentUuid": "7e6a7019_0e1540ec",
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b17c56f7_f02e6b83",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectInitializationAction.java",
        "patchSetId": 3
      },
      "lineNbr": 164,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2023-12-28T10:59:23Z",
      "side": 1,
      "message": "\u003e I think we should have it in the initProject as well.\n\nSorry I said \"as well\", but I meant \"instead\".\n\nUnless I am missing something al line 108 to 114 we do:\n\n```\nif (checkContentType(contentType, MediaType.JSON_UTF_8)) {\n    // init project request includes project configuration in JSON format.\n    initProjectStatus \u003d initProjectWithConfiguration(httpServletRequest, gitRepositoryName);\n} else if (checkContentType(contentType, MediaType.PLAIN_TEXT_UTF_8)) {\n    // init project request does not include project configuration.\n    initProjectStatus \u003d initProject(gitRepositoryName);\n}\n```\n\nThat means that _unless_ we create a project with configuration we don\u0027t want to notify the project creation. Is that what we want?",
      "parentUuid": "075a5c30_aeee8d31",
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c68f68b2_5e961c4f",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectInitializationAction.java",
        "patchSetId": 3
      },
      "lineNbr": 164,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-28T11:26:30Z",
      "side": 1,
      "message": "Since the change is on master, I believe the clients will be using the `initProjectWithConfiguration` by default. I believe the old code (the else if statement) is left there for backwards compatibility. The project notification won\u0027t happen if the caller is on an old version of the plugin and the receiver in the new version, but this is a temporary state? And is it such a big deal? Eventually all users should move to the newer plugin version anyway.",
      "parentUuid": "b17c56f7_f02e6b83",
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c281f53b_4d701654",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectInitializationAction.java",
        "patchSetId": 3
      },
      "lineNbr": 164,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-12-29T13:11:22Z",
      "side": 1,
      "message": "Marking as resolved, as all questions have been answered. I agree with Chris that this is a change for master only, therefore the legacy endpoint should not be considered as it will be unused in master.",
      "parentUuid": "c68f68b2_5e961c4f",
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9583a4b8_e85a929d",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectInitializationAction.java",
        "patchSetId": 3
      },
      "lineNbr": 176,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-12-27T21:58:46Z",
      "side": 1,
      "message": "It may not be obvious to the reader of this piece of code that the input label is actually the instance-id. Maybe worth a comment here?",
      "range": {
        "startLine": 176,
        "startChar": 53,
        "endLine": 176,
        "endChar": 69
      },
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d20df43a_6520f0c9",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/api/ProjectInitializationAction.java",
        "patchSetId": 3
      },
      "lineNbr": 176,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-28T10:07:23Z",
      "side": 1,
      "message": "I dont see a value in the comment here. The method signature already tells you this is the instance id\n```\nprivate void notifyListenersOfNewProjectCreation(String projectName, String instanceId) {}\n```\nLastly, it is also used 3 lines above without any comment.",
      "parentUuid": "9583a4b8_e85a929d",
      "range": {
        "startLine": 176,
        "startChar": 53,
        "endLine": 176,
        "endChar": 69
      },
      "revId": "3ee16e4e6c67b786113d8e63cbe50be490d9ddb0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}