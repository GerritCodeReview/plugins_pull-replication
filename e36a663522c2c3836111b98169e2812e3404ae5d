{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "3d415d42_aea1c3a3",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/PullReplicationModule.java",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2024-01-18T23:07:41Z",
      "side": 1,
      "message": "You cannot refer to the class statically in this way, otherwise if the healthcheck plugin isn\u0027t installed it would cause the `PullReplicationModule` class loading to fail as well.",
      "revId": "e36a663522c2c3836111b98169e2812e3404ae5d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "406dfe3c_17347da2",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/PullReplicationModule.java",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2024-01-19T09:29:44Z",
      "side": 1,
      "message": "No, it will not, it can only cause compile errors which ofc can\u0027t be the case as the healthcheck plugin is now a dependency.",
      "parentUuid": "3d415d42_aea1c3a3",
      "revId": "e36a663522c2c3836111b98169e2812e3404ae5d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4111962d_6836f76c",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/PullReplicationModule.java",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2024-01-19T16:02:07Z",
      "side": 1,
      "message": "Point taken, the class isn\u0027t statically referenced in any of the fields, therefore it won\u0027t fail the instantiation.",
      "parentUuid": "406dfe3c_17347da2",
      "revId": "e36a663522c2c3836111b98169e2812e3404ae5d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0cb0d0a9_d0a9d507",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/PullReplicationModule.java",
        "patchSetId": 5
      },
      "lineNbr": 146,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2024-01-19T16:02:07Z",
      "side": 1,
      "message": "Not needed.\n\n```suggestion\n```",
      "range": {
        "startLine": 146,
        "startChar": 5,
        "endLine": 146,
        "endChar": 52
      },
      "revId": "e36a663522c2c3836111b98169e2812e3404ae5d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9b2b7711_24626d30",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/PullReplicationModule.java",
        "patchSetId": 5
      },
      "lineNbr": 147,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2024-01-18T23:07:41Z",
      "side": 1,
      "message": "This module installation needs to happen purely via reflection.\n\n```suggestion\n      Class\u003cModule\u003e pullReplicationHealthCheckModuleClass \u003d Class.forName(\"com.googlesource.gerrit.plugins.healthcheck.HealthCheckExtensionApiModule\");\n      install(pullReplicationHealthCheckModuleClass.getInstance());\n```",
      "range": {
        "startLine": 146,
        "startChar": 0,
        "endLine": 147,
        "endChar": 54
      },
      "revId": "e36a663522c2c3836111b98169e2812e3404ae5d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1d3944ec_aa643aa9",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/PullReplicationModule.java",
        "patchSetId": 5
      },
      "lineNbr": 147,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2024-01-19T09:29:44Z",
      "side": 1,
      "message": "Can you please elaborate, I am confused? L147 won\u0027t be executed unless the healthcheck plugin is present, which will be true if L146 doesnt throw an exception. This satisfies the requirement, ie register the custom healthcheck (ie install the `PullReplicationHealthCheckModule` only if the healthcheck is installed. \n\nHere, you are suggesting to install the `HealthCheckExtensionApiModule` module only if the class is available - which you check via reflection?",
      "parentUuid": "9b2b7711_24626d30",
      "range": {
        "startLine": 146,
        "startChar": 0,
        "endLine": 147,
        "endChar": 54
      },
      "revId": "e36a663522c2c3836111b98169e2812e3404ae5d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "32c3164e_d16776c6",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/PullReplicationModule.java",
        "patchSetId": 5
      },
      "lineNbr": 147,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2024-01-19T16:02:07Z",
      "side": 1,
      "message": "I see that Java would still allow to load the class even if you have referencing statically the `healthcheck` plugin\u0027s classes, which is cool.\n\nPossibly that\u0027s because the referenced classes are not used in any fields, which would then work in this case.",
      "parentUuid": "1d3944ec_aa643aa9",
      "range": {
        "startLine": 146,
        "startChar": 0,
        "endLine": 147,
        "endChar": 54
      },
      "revId": "e36a663522c2c3836111b98169e2812e3404ae5d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "97c8ec41_df471b63",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/PullReplicationModule.java",
        "patchSetId": 5
      },
      "lineNbr": 148,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2024-01-18T23:07:41Z",
      "side": 1,
      "message": "Can you narrow this to a more specific exception?",
      "range": {
        "startLine": 148,
        "startChar": 13,
        "endLine": 148,
        "endChar": 24
      },
      "revId": "e36a663522c2c3836111b98169e2812e3404ae5d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e2cde350_f62cce6f",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/PullReplicationModule.java",
        "patchSetId": 5
      },
      "lineNbr": 148,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2024-01-19T09:29:44Z",
      "side": 1,
      "message": "This shows intent; _whatever_ the error, we don\u0027t want the module to be installed, but we want the loading of the plugin to continue uninterrupted.",
      "parentUuid": "97c8ec41_df471b63",
      "range": {
        "startLine": 148,
        "startChar": 13,
        "endLine": 148,
        "endChar": 24
      },
      "revId": "e36a663522c2c3836111b98169e2812e3404ae5d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bd594c8d_3e5f4499",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/PullReplicationModule.java",
        "patchSetId": 5
      },
      "lineNbr": 148,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2024-01-19T16:02:07Z",
      "side": 1,
      "message": "I politely and respectfully disagree. The code must manage the expectations, not ignoring any possible error.\n\nAlso, we should check if the class that we aren\u0027t able to find is the \"com/googlesource/gerrit/plugins/healthcheck/check/HealthCheck\" and not other ones.\n\nImagine that we have any other errors, we would silently just ignore the health checks and the Gerrit admin won\u0027t notice.",
      "parentUuid": "e2cde350_f62cce6f",
      "range": {
        "startLine": 148,
        "startChar": 13,
        "endLine": 148,
        "endChar": 24
      },
      "revId": "e36a663522c2c3836111b98169e2812e3404ae5d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "81845d73_44058bab",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/PullReplicationModule.java",
        "patchSetId": 5
      },
      "lineNbr": 150,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2024-01-19T16:02:07Z",
      "side": 1,
      "message": "We need to check if the class that isn\u0027t found is the expected one, then we just inform that the healthchecks are not installed.\n\nIf the class is anything else, we should re-throw the exception and make the plugin loading fail.",
      "range": {
        "startLine": 149,
        "startChar": 0,
        "endLine": 150,
        "endChar": 103
      },
      "revId": "e36a663522c2c3836111b98169e2812e3404ae5d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3e2d35c7_7b63e979",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/PullReplicationModule.java",
        "patchSetId": 5
      },
      "lineNbr": 151,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2024-01-19T16:02:07Z",
      "side": 1,
      "message": "```suggestion\n    try {\n      install(new PullReplicationHealthCheckModule());\n    } catch (NoClassDefFoundError e) {\n\n      if(e.getMessage().contains(\"com/googlesource/gerrit/plugins/healthcheck/check/HealthCheck\")) {\n        flogger.atInfo().log(\n                \"Skipping registration of pull replication health checks; healthcheck plugin API not loaded\");\n      } else {\n        throw e;\n      }\n    }\n```",
      "range": {
        "startLine": 145,
        "startChar": 0,
        "endLine": 151,
        "endChar": 5
      },
      "revId": "e36a663522c2c3836111b98169e2812e3404ae5d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}