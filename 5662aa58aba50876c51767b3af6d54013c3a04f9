{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ff07cde2_cd96d66a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2023-10-25T12:38:07Z",
      "side": 1,
      "message": "It\u0027s still WIP because we want to have a look if there is an easy way to test it. Currently we have a test which works but it\u0027s a white-box test:\n```\n  public void shouldProcessBeforeStartupEventsOnce() throws Exception {\n    Event event \u003d new TestEvent(\"refs/changes/01/1/meta\");\n    objectUnderTest.stop();\n    objectUnderTest.onEvent(event);\n    verify(fetchRestApiClient, never()).callSendObjects(any(), anyString(), anyLong(), any(), any());\n\n    objectUnderTest.start();\n    verify(fetchRestApiClient).callSendObjects(any(), anyString(), anyLong(), any(), any());\n\n    objectUnderTest.stop();\n    objectUnderTest.start();\n    verify(fetchRestApiClient).callSendObjects(any(), anyString(), anyLong(), any(), any());\n  }\n```",
      "revId": "5662aa58aba50876c51767b3af6d54013c3a04f9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f6f08cea_faca0066",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2023-10-25T14:16:43Z",
      "side": 1,
      "message": "@luca.milanesio@gmail.com WDYT? ^",
      "parentUuid": "ff07cde2_cd96d66a",
      "revId": "5662aa58aba50876c51767b3af6d54013c3a04f9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "72bf8021_aeb386c7",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/ReplicationQueue.java",
        "patchSetId": 1
      },
      "lineNbr": 537,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2023-10-25T12:38:07Z",
      "side": 1,
      "message": "we decided to use poll instead of peek and remove to make sure that if fire throws exception we do not get stuck on the event",
      "range": {
        "startLine": 537,
        "startChar": 5,
        "endLine": 537,
        "endChar": 62
      },
      "revId": "5662aa58aba50876c51767b3af6d54013c3a04f9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a7786e8b_00eebf18",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/ReplicationQueue.java",
        "patchSetId": 1
      },
      "lineNbr": 537,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2023-10-25T13:15:13Z",
      "side": 1,
      "message": "But if `fire` L541 throws an exception then the event is lost, isn\u0027t it?. Can we lose events?",
      "parentUuid": "72bf8021_aeb386c7",
      "range": {
        "startLine": 537,
        "startChar": 5,
        "endLine": 537,
        "endChar": 62
      },
      "revId": "5662aa58aba50876c51767b3af6d54013c3a04f9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9782e122_615594c3",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/ReplicationQueue.java",
        "patchSetId": 1
      },
      "lineNbr": 537,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2023-10-25T14:15:13Z",
      "side": 1,
      "message": "Yes, we will loose message exactly as we do now, plus:\n1. fire method doesn\u0027t declare any exceptions so only runtime exception can cause message to be lost\n2. this method doesn\u0027t have any retry mechanism, we can simulate that by adding event at the end of the queue but we can end up in endless loop. Actually our first approach was with peek and remove\n3. we should check if fireBeforeStartupEvents is not a blocking operation because it can delay the plugin startup in case of retries\n4. it\u0027s a memory queue so plugin restart during the startup will cause message lost anyway\n\nBut I agree we could have a separate change to improve that part of the code",
      "parentUuid": "a7786e8b_00eebf18",
      "range": {
        "startLine": 537,
        "startChar": 5,
        "endLine": 537,
        "endChar": 62
      },
      "revId": "5662aa58aba50876c51767b3af6d54013c3a04f9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c6f4cadc_9b7d68c3",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/ReplicationQueue.java",
        "patchSetId": 1
      },
      "lineNbr": 537,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2023-10-25T15:12:22Z",
      "side": 1,
      "message": "Tx for the clarification. Very accurate.",
      "parentUuid": "9782e122_615594c3",
      "range": {
        "startLine": 537,
        "startChar": 5,
        "endLine": 537,
        "endChar": 62
      },
      "revId": "5662aa58aba50876c51767b3af6d54013c3a04f9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}