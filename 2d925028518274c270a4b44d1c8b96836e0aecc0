{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "80ca254b_d85e1b76",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2025-01-16T15:43:37Z",
      "side": 1,
      "message": "API\n```suggestion\nprovides a backfill mechanism for REST API calls missed when the node was\n```",
      "range": {
        "startLine": 10,
        "startChar": 37,
        "endLine": 10,
        "endChar": 40
      },
      "revId": "2d925028518274c270a4b44d1c8b96836e0aecc0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2297082a_de4a63fc",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2025-01-16T16:45:21Z",
      "side": 1,
      "message": "Fix applied.",
      "parentUuid": "80ca254b_d85e1b76",
      "range": {
        "startLine": 10,
        "startChar": 37,
        "endLine": 10,
        "endChar": 40
      },
      "revId": "2d925028518274c270a4b44d1c8b96836e0aecc0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "45aeac26_1de53d58",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2025-01-16T15:43:37Z",
      "side": 1,
      "message": "I tested this E2E and it works, however I think there are some small issues we should address.",
      "revId": "2d925028518274c270a4b44d1c8b96836e0aecc0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eccfab12_444801d2",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/event/StreamEventListener.java",
        "patchSetId": 1
      },
      "lineNbr": 187,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2025-01-16T15:43:37Z",
      "side": 1,
      "message": "it is possible to delete a project and yet \"Preserve GIT Repository\".\n\nIn this case (but also in the REST-API case), we would still end up deleting the repository.\n\nAlso, the `force deletion with existing changes` is ignored.\n\nTo make this work we should probably extend the `project-deleted` event to carry on these extra information, so this is out-of-scope for this change, we should however consider mentioning this in the documentation, as a caveat.",
      "range": {
        "startLine": 187,
        "startChar": 15,
        "endLine": 187,
        "endChar": 51
      },
      "revId": "2d925028518274c270a4b44d1c8b96836e0aecc0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "68d68507_c52f4b5a",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/event/StreamEventListener.java",
        "patchSetId": 1
      },
      "lineNbr": 187,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2025-01-16T17:01:19Z",
      "side": 1,
      "message": "\u003e it is possible to delete a project and yet \"Preserve GIT Repository\".\n\nThat information is not available in the event, therefore there\u0027s no way that the pull-replication plugin can honour it.\n\n\u003e In this case (but also in the REST-API case), we would still end up deleting the repository.\n\nYes, that is the expected behaviour IMHO: this change is purely using the existing mechanism via stream events.\n\n\u003e Also, the `force deletion with existing changes` is ignored.\n\nThat\u0027s the business logic implemented by the delete-project plugin and then deleting the project and, if requested, also the changes. The removal of the changes will trigger the events and therefore removing the changes replicated through pull-replication.\n\n\u003e To make this work we should probably extend the `project-deleted` event to carry on these extra information, so this is out-of-scope for this change, we should however consider mentioning this in the documentation, as a caveat.\n\nCorrect: out of scope of this change and, possibly, not even the role of the pull-replication plugin to implement.",
      "parentUuid": "eccfab12_444801d2",
      "range": {
        "startLine": 187,
        "startChar": 15,
        "endLine": 187,
        "endChar": 51
      },
      "revId": "2d925028518274c270a4b44d1c8b96836e0aecc0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7fced18b_2fed9295",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/event/StreamEventListener.java",
        "patchSetId": 1
      },
      "lineNbr": 188,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2025-01-16T15:43:37Z",
      "side": 1,
      "message": "Why casting to `ProjectEvent`?\nWe know precisely which event type we expect here.\n\nShouldn\u0027t this just be:\n\n```suggestion\n    } else if (event instanceof ProjectDeletedEvent) {\n      deleteProject((ProjectDeletedEvent) event);\n    }\n```",
      "range": {
        "startLine": 187,
        "startChar": 0,
        "endLine": 188,
        "endChar": 62
      },
      "revId": "2d925028518274c270a4b44d1c8b96836e0aecc0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e7a738bb_e0def481",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/event/StreamEventListener.java",
        "patchSetId": 1
      },
      "lineNbr": 188,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2025-01-16T17:01:19Z",
      "side": 1,
      "message": "Fix applied.",
      "parentUuid": "7fced18b_2fed9295",
      "range": {
        "startLine": 187,
        "startChar": 0,
        "endLine": 188,
        "endChar": 62
      },
      "revId": "2d925028518274c270a4b44d1c8b96836e0aecc0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "00d062a2_faff204c",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/event/StreamEventListener.java",
        "patchSetId": 1
      },
      "lineNbr": 199,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2025-01-16T15:43:37Z",
      "side": 1,
      "message": "We shouldn\u0027t delete the project blindly, but honour the ` replicateProjectDeletions` flag\n\nWhen deleting a project via REST-API this setting is already honoured (caller side). However, when consuming via broker we must check that we can delete the \nproject by checking the remote configuration (consumer side).\n\nWe follow the same approach for `createMissingRepositories` in `shouldReplicateProject` [1].\n\n[1] https://gerrit.googlesource.com/plugins/pull-replication/+/refs/heads/stable-3.10/src/main/java/com/googlesource/gerrit/plugins/replication/pull/event/StreamEventListener.java#183",
      "range": {
        "startLine": 199,
        "startChar": 6,
        "endLine": 199,
        "endChar": 92
      },
      "revId": "2d925028518274c270a4b44d1c8b96836e0aecc0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7dde5ea9_dafe04d8",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/event/StreamEventListener.java",
        "patchSetId": 1
      },
      "lineNbr": 199,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2025-01-16T17:01:19Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "00d062a2_faff204c",
      "range": {
        "startLine": 199,
        "startChar": 6,
        "endLine": 199,
        "endChar": 92
      },
      "revId": "2d925028518274c270a4b44d1c8b96836e0aecc0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d3531843_81670888",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/pull/event/StreamEventListener.java",
        "patchSetId": 1
      },
      "lineNbr": 203,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2025-01-16T15:43:37Z",
      "side": 1,
      "message": "In a case where the REST-API and the stream events consumptions are both enabled, this would log a failure if the repository was already deleted thanks to the REST-API.\n\nShould we check if the repo doesn\u0027t exist already in which case this becomes a noop?",
      "range": {
        "startLine": 200,
        "startChar": 0,
        "endLine": 203,
        "endChar": 5
      },
      "revId": "2d925028518274c270a4b44d1c8b96836e0aecc0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}